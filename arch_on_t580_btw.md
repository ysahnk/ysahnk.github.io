<img src="/images/iconhikari02.jpg" alt="penguin icon image" width="100" height="100" />

### I use arch on T580, btw
|   |                   |
|---|-------------------|
|MEM|DDR4-2400 PC4-19200|
|CPU|Intel(R) Core(TM) i5-8250U CPU @ 1.60GHz / coffee lake-s|
|GPU|Intel UHD Graphics 620 / Gen9.5|
|SSD|M.2 SSD / PCIe NVMe, PCIe 3.0 x 2, 16Gb/s|

### Thunderbolt firmware problem
> [!IMPORTANT]
> T580ã‚’å«ã‚€ã€ã“ã®ä¸–ä»£ã®Thinkpadã«ã¯ãƒ•ã‚¡ãƒ¼ãƒ ã‚¦ã‚§ã‚¢ã«é–¢ã—ã¦ã®è‡´å‘½çš„ãªå•é¡ŒãŒå­˜åœ¨ã—ã¾ã™ã€‚

[The "Thunderbolt Firmware Problem" Explained (reddit.com)](https://www.reddit.com/r/thinkpad/comments/1dfdp18/the_thunderbolt_firmware_problem_explained/)

> 2017å¹´ã‹ã‚‰2019å¹´ã«ã‹ã‘ã¦è£½é€ ã•ã‚ŒãŸThinkPadã®è¤‡æ•°ã®ãƒ¢ãƒ‡ãƒ«ã«ã¯ã€Thunderbolt 3ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒã—ã°ã‚‰ãã™ã‚‹ã¨è‡ªå‹•çš„ã«åœæ­¢ã™ã‚‹ã¨ã„ã†å„ä»‹ãªãƒã‚°ãŒã‚ã‚Šã¾ã—ãŸã€‚çŠ¶æ³ã¯æ‚ªåŒ–ã—ã€Lenovoã¯ã“ã®å•é¡Œã‚’èªã‚ã€ãƒ•ã‚¡ãƒ¼ãƒ ã‚¦ã‚§ã‚¢ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’ãƒªãƒªãƒ¼ã‚¹ã—ã¦å•é¡Œã‚’è§£æ±ºã—ã‚ˆã†ã¨ã—ã¾ã—ãŸã€‚ã“ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã¯ã»ã¨ã‚“ã©ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¨ã£ã¦æœ‰åŠ¹ã§ã€ä½•ã‚‰ã‹ã®ç†ç”±ã§ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’å®Ÿè¡Œã§ããªã‹ã£ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€ãƒ‡ãƒã‚¤ã‚¹ã‚’é€ä»˜ã—ã¦ãƒã‚¶ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’äº¤æ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚ã—ã‹ã—ã€ã“ã‚Œã¯ã‚‚ã¯ã‚„ä¸å¯èƒ½ãªãŸã‚ã€ç¾çŠ¶ã§ã¯è‡ªåˆ†ã§è¡Œã†ã—ã‹ã‚ã‚Šã¾ã›ã‚“ã€‚

> ãƒ¦ãƒ‹ãƒƒãƒˆã‚’å…¥æ‰‹ã—ãŸã‚‰ã™ãã«ã€ Lenovoã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã§Thunderbolt/NVMã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ãƒ•ã‚¡ãƒ¼ãƒ ã‚¦ã‚§ã‚¢ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•ã‚’ ã”ç¢ºèªãã ã•ã„ã€‚ä¸­å¤å¸‚å ´ã«æµé€šã™ã‚‹å‰ã«ã€å„ªç§€ãªITéƒ¨é–€ã«ç®¡ç†ã•ã‚Œã¦ã„ãŸãƒ‡ãƒã‚¤ã‚¹ã§ã‚ã‚Œã°ã€ã»ã¨ã‚“ã©ã®ãƒ‡ãƒã‚¤ã‚¹ã¯æ—¢ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ãŒã€äºˆé˜²ä¿å®ˆã“ããŒæœ€è‰¯ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã§ã‚ã‚‹ãŸã‚ã€å¿µã®ãŸã‚ç¢ºèªã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã„ã¦ã€ã¾ã å•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ãªã„å ´åˆã¯ã€Lenovoã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã®æŒ‡ç¤ºã«å¾“ã£ã¦ã€ãƒ•ã‚¡ãƒ¼ãƒ ã‚¦ã‚§ã‚¢ã®æ›¸ãæ›ãˆæ–¹æ³•ã‚’ã”ç¢ºèªãã ã•ã„ã€‚ã“ã®ä½œæ¥­ã‚’å…ˆå»¶ã°ã—ã«ã™ã‚‹ã¨ã€ã™ãã«å¯¾å‡¦ã—ãªã„ã¨ã€å¾Œã€…å•é¡ŒãŒé¡•åœ¨åŒ–ã—ã¦ã—ã¾ã†å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ç¾åœ¨ï¼ˆ2025å¹´ï¼‰ä»¥é™ã«å…¥æ‰‹ã™ã‚‹å ´åˆã¯ã»ã¼é–“é•ã„ãªãä¸­å¤å“ã§ã—ã‚‡ã†ã‹ã‚‰ã€å¼•ç”¨æ–‡ä¸­ã«ã‚‚ã‚ã‚‹ã‚ˆã†ã«ã€ä»¥å‰ã®ã‚ªãƒ¼ãƒŠãƒ¼ãŒã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’æ¸ˆã¾ã›ã¦ã„ãŸã‹ã©ã†ã‹ãŒå•é¡Œã¨ãªã‚Šã¾ã™ã€‚ã‚ãŸã—ã®å€‹äººçš„ãªå°è±¡ã§ã™ãŒã€ãƒãƒƒãƒˆä¸Šã§æ¤œç´¢ã—ãŸã¨ãã«ã“ã®å•é¡Œã«ã¤ã„ã¦ã®æ—¥æœ¬èªã«ã‚ˆã‚‹æƒ…å ±ãŒã»ã¨ã‚“ã©è¦‹ã¤ã‹ã‚‰ãªã„ã“ã¨ã‚’è€ƒãˆã‚‹ã¨ã€æ²¹æ–­ã›ãšã«å¿…ãšã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆçŠ¶æ³ã‚’ç¢ºèªã—ã¦ãŠãã¹ãã ã¨æ€ã„ã¾ã™ã€‚

ä½•ã‚„ã‚‰å¤§è¢ˆè£Ÿãªæ„Ÿã˜ãŒã—ã¾ã™ãŒã€å®Ÿéš›ã«ã‚„ã‚‰ãªã‘ã‚Œã°ã„ã‘ãªã„ã“ã¨ã¯å¤šãã¯ã‚ã‚Šã¾ã›ã‚“ã€‚`LVFSï¼ˆLinux Vendor Firmware Serviceï¼‰`ã¨ã„ã†å„ç¤¾ã®ãƒ•ã‚¡ãƒ¼ãƒ ã‚¦ã‚§ã‚¢æ›´æ–°ã‚’ä¸€å…ƒçš„ã«é…å¸ƒã™ã‚‹ãŸã‚ã®ã‚µãƒ¼ãƒ“ã‚¹ã¨ã€ãã‚Œã‚’åˆ©ç”¨ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã‚ã‚‹`fwupd`ã¨ã®é–‹ç™ºã«ã‚ˆã‚Šã€linuxç’°å¢ƒã§ã®ãƒ•ã‚¡ãƒ¼ãƒ ã‚¦ã‚§ã‚¢æ›´æ–°ã¯é£›èºçš„ã«ç°¡å˜ã«ãªã‚Šã¾ã—ãŸã€‚

```bash
pacman -S fwupd                # additionally `pacman -S udisks2 efivar` for UEFI firmware update
fwupdmgr get-devices           # display all devices detected by fwupd
fwupdmgr refresh               # download latest metadata
fwupdmgr get-updates           # list available updates
fwupdmgr update                # install updates
```

â€¦â€¦ã¨æœ¬æ¥ãªã‚‰ä»¥ä¸Šã®ã‚³ãƒãƒ³ãƒ‰ã ã‘ã§ååˆ†ã§ã€ã“ã®é …ç›®ãŒæ›¸ã‹ã‚Œã‚‹å¿…è¦æ€§ã‚‚ãªã‹ã£ãŸã¯ãšãªã®ã§ã™ãŒã€å®Ÿã®ã¨ã“ã‚ã‚ãŸã—ã®ç’°å¢ƒã§ã“ã®æ–¹æ³•ã§ã¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒæˆåŠŸã—ã¾ã›ã‚“ã§ã—ãŸã€‚

1. `fwupdmgr get-devices`ã§`Thunderbolt host controller`ã‚’èªè­˜ã—ã¦ã„ã‚‹ã“ã¨ã¯ç¢ºèªã§ãã‚‹ã€‚
   - èªè­˜ã—ãªã„å ´åˆï¼š[https://wiki.archlinux.org/title/Thunderbolt#Forcing_power](https://wiki.archlinux.org/title/Thunderbolt#Forcing_power)
2. `fwupdmgr get-updates`ã§ã€ãƒã‚°ã‚’å®Œå…¨ã«ä¿®æ­£ã™ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³20ã¸ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¹ãã¨ã“ã‚
3. ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ14ã§ã‚ã‚‹ã«ã‚‚é–¢ã‚ã‚‰ãšã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãªã—ã¨å‡ºã¦ã—ã¾ã†ã€‚

ä»•æ–¹ãªã„ã®ã§æ¬¡ã«ä»¥ä¸‹ã®ã‚ˆã†ã«ã€LVFSã‚µã‚¤ãƒˆã‹ã‚‰å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€æ‰‹å‹•ã§ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è©¦ã¿ã¾ã—ãŸã€‚ã—ã‹ã—ã€ã“ã‚Œã‚‚ã†ã¾ãé€²ã¿ã¾ã›ã‚“ã§ã—ãŸã€‚`did not find magic`ã¨ã„ã£ãŸã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã—ãŸã€‚

```bash
curl https://r2.fwupd.org/lvfs-prod/86e4f830ccc892f1ca8963b1e8e34164e59af4ed-Lenovo-ThinkPad-T580-Thunderbolt-Firmware-N27TF18W_AssistMode.cab > foo.cab
fwupdmgr local-install foo.cab --verbose
```

fwupdã‹ã€archã®ã‚«ãƒ¼ãƒãƒ«ã‹ã€ã‚ãŸã—ã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‹ã€ã©ã“ã«å•é¡ŒãŒã‚ã‚‹ã®ã‹ã‚ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€redditã‚’çœºã‚ã¦ã„ã‚‹ã¨linuxmintã§ã®æˆåŠŸä¾‹ãŒæ•°å¤šãæŠ•ç¨¿ã•ã‚Œã¦ã„ãŸã®ã§ã€ãã‚Œã«å€£ã†ã“ã¨ã«ã—ã¾ã—ãŸï¼ˆyes, I use mint, btwï¼‰ã€‚

1. isoã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ¡ãƒ‡ã‚£ã‚¢ã‚’ä½œæˆã€‚
2. `fwupdmgr get-updates`ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³20ã¸ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚ã‚Šã¨ã®è¡¨ç¤ºï¼
3. ã—ã‹ã—ã„ã–`fwupdmgr update`ã™ã‚‹ã¨ä½•æ•…ã‹é€šã‚‰ãªã„ã€‚ä¸‡äº‹ä¼‘ã™ã‹ã¨æ€ã£ãŸãŒâ€¦â€¦
4. `fwupdmgr install <DIVICE-ID>`ã§çµå±€è§£æ±ºã§ããŸã€‚
   - `DEVICE-ID`ã¯`fwupdmgr get-devices`ã§ç¢ºèªã§ãã‚‹`4214d8e87e1aa7de57c19e5954bbef2e462b86a4`ã®ã‚ˆã†ãªæ–‡å­—åˆ—ã€‚
   - ã“ã®ã‚³ãƒãƒ³ãƒ‰ã§å‡ºã¦ãã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å¾“ã£ã¦ã€ã¾ãš`14->18`ã€ãã®å¾Œ`18->20`ã¨æ®µéšçš„ã«ã‚„ã‚‹ã¨ã€ç„¡äº‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³20ã¾ã§åˆ°é”ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

ä¸€å¿œæ›¸ã„ã¦ãŠãã¨ã€å®Ÿéš›ã«mintã‚’ãƒãƒ¼ãƒ‰ãƒ‰ãƒ©ã‚¤ãƒ–ã«ã¾ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ã¯ãªãã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ¡ãƒ‡ã‚£ã‚¢ã‹ã‚‰`fwupd`ã‚’ä½¿ç”¨ã—ã¦ã™ã¹ã¦ã®æ“ä½œã‚’å®Œäº†ã§ãã¾ã™ã€‚

### Yellowish tint monitor

ã“ã®æ©Ÿç¨®ã‚’å«ã‚“ã ã„ãã¤ã‹ã®Thinkpadã®ãƒ¢ãƒ‹ã‚¿ãƒ¼ã®è‰²å‘³ãŒé»„è‰²ãŒã‹ã£ã¦ã„ã‚‹ã€ã¨ã„ã†è©•åˆ¤ãŒãƒãƒƒãƒˆä¸Šã§è¦‹ã‚‰ã‚Œã¾ã™ã€‚ã‚ãŸã—ã®çµŒé¨“ã‹ã‚‰è¨€ã‚ã›ã¦ã‚‚ã‚‰ã†ã¨ã€ã“ã‚Œã¯æœ¬å½“ã§ã™ã€‚ç‰¹ã«T580ä»¥å‰ã«ä½¿ç”¨ã—ã¦ã„ãŸãƒ©ãƒƒãƒ—ãƒˆãƒƒãƒ—ãŒé’å‘³ã®å¼·ã„ãƒ¢ãƒ‹ã‚¿ãƒ¼ã ã£ãŸã®ã§ã€æœ€åˆã®ã†ã¡ã¯ãã®è½å·®ã§ã‹ãªã‚Šé»„è‰²ãè¦‹ãˆã¦ã„ã¾ã—ãŸã€‚ãŸã ã—ã€ä½¿ç”¨ã—ã¦ã„ã‚‹ã†ã¡ã«ä¸€ãƒ¶æœˆã‚‚ã—ãªã„ã§æ…£ã‚Œã¦ãã¦æ™®é€šã«è¦‹ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚é€†ã«è¨€ã†ã¨ã€æ™®é€šã‚‚ã—ãã¯é’å‘³ã®ãƒ¢ãƒ‹ã‚¿ãƒ¼ã¨ä¸€ç·’ã«æ¨ªã«ä¸¦ã¹ã¦ä½¿ç”¨ã™ã‚‹å ´åˆã«ã¯ã€ã‚‚ã—ã‹ã™ã‚‹ã¨ãšã£ã¨é•å’Œæ„ŸãŒæ®‹ã‚Šç¶šã‘ã‚‹ã“ã¨ã«ãªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚å˜ç‹¬ã§ä½¿ç”¨ã™ã‚‹ã ã‘ãªã‚‰ã»ã¨ã‚“ã©å•é¡Œã¯ãªã„ã“ã¨ã‚’ã‚ãŸã—ãŒï¼ˆèª°ï¼Ÿï¼‰ä¿è¨¼ã—ã¾ã™ã€‚

### Bluetooth

ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ãªã„ã®ã§ã€é›»æºã‚’å…¥ã‚Œã¦ãƒ–ãƒ¼ãƒˆå¾Œã«ã¾ãšã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ç€åœ°ã™ã‚‹ã®ã§ã™ãŒã€ãã®ç”»é¢ã§å¿…ãšä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‰²ã‚Šè¾¼ã‚€ã‚ˆã†ãªå½¢ã§å‡ºåŠ›ã•ã‚Œã‚‹ã®ãŒæ°—ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚
```
Bluetooth: hci0: Reading supported features failed (-16)
```
å‘¨è¾ºã®ãƒ­ã‚°ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã—ãŸã€‚
```
Aug 30 09:56:26 laptop kernel: Bluetooth: hci0: Waiting for firmware download to complete
Aug 30 09:56:26 laptop kernel: Bluetooth: hci0: Firmware loaded in 1742667 usecs
Aug 30 09:56:26 laptop kernel: Bluetooth: hci0: Waiting for device to boot
Aug 30 09:56:26 laptop kernel: Bluetooth: hci0: Device booted in 12901 usecs
Aug 30 09:56:26 laptop kernel: Bluetooth: hci0: Found Intel DDC parameters: intel/ibt-12-16.ddc
Aug 30 09:56:26 laptop kernel: Bluetooth: hci0: Applying Intel DDC parameters completed
Aug 30 09:56:26 laptop kernel: Bluetooth: hci0: Firmware revision 0.1 build 19 week 44 2021
Aug 30 09:56:26 laptop kernel: Bluetooth: hci0: Reading supported features failed (-16)
Aug 30 09:56:26 laptop kernel: Bluetooth: hci0: Error reading debug features
Aug 30 09:56:26 laptop kernel: Bluetooth: hci0: HCI LE Coded PHY feature bit is set, but its usage is not supported.
Aug 30 09:56:26 laptop kernel: Bluetooth: MGMT ver 1.23
Aug 30 09:56:26 laptop bluetoothd[1083]: Battery Provider Manager created
```
ChatGPTã•ã‚“ã«è¨Šã­ã¦ã¿ã¾ã—ãŸã€‚

> -16 ã¯ EBUSYï¼ˆãƒªã‚½ãƒ¼ã‚¹ãŒãƒ“ã‚¸ãƒ¼çŠ¶æ…‹ï¼‰ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚\
> ã“ã‚Œã¯ã€Bluetooth ãƒ•ã‚¡ãƒ¼ãƒ ã‚¦ã‚§ã‚¢ã¾ãŸã¯ãƒãƒƒãƒ—ãŒã¾ã åˆæœŸåŒ–å®Œäº†ã—ã¦ã„ãªã„ã¨ãã«æ©Ÿèƒ½ã®èª­ã¿å–ã‚Šã‚’è©¦ã¿ãŸã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚\
> ã“ã®ã‚¨ãƒ©ãƒ¼ã¯ Bluetooth ã®åŸºæœ¬æ©Ÿèƒ½ï¼ˆãƒšã‚¢ãƒªãƒ³ã‚°ï¼ãƒ•ã‚¡ã‚¤ãƒ«é€ä¿¡ãªã©ï¼‰ã«ã¯å½±éŸ¿ã—ãªã„ã“ã¨ãŒã»ã¨ã‚“ã©ã§ã™ã€‚

æ°—å‘³ãŒæ‚ªã„ã§ã™ãŒå•é¡Œã¯ãªã„ã‚ˆã†ã§ã™ã€‚ã¡ãªã¿ã«ã“ã‚Œã¯bluetoothç³»ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å°å…¥ã™ã‚‹ä»¥å‰ã‹ã‚‰ç™ºç”Ÿã—ã¦ã„ã¾ã—ãŸã€‚ãã‚Œã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚‰ç›´ã£ãŸã¨ã„ã†ã‚ˆã†ãªã“ã¨ã‚‚ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚å¿…è¦æœ€å°é™ã®bluetoothã®å°å…¥ã¨ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¦ã¿ãŸã¨ã“ã‚â€¦â€¦

```bash
pacman -S bluez bluez-utils
systemctl enable --now bluetooth

bluetoothctl
> scan on
> scan off
> devices                           # list scanned and pairable devices
> pair <device_address>             # OK
> trust <device_address>            # OK
> connect <device_address>          # FAILED!
```
```
bluetoothd[7010]: [:1.50:method_call] > org.bluez.Device1.Connect [#31]
bluetoothd[7010]: src/device.c:connect_profiles() /org/bluez/hci0/dev_XX_XX_XX_XX_XX_XX (all), client :1.50
bluetoothd[7010]: profiles/audio/a2dp.c:a2dp_source_connect() path /org/bluez/hci0/dev_XX_XX_XX_XX_XX_XX
bluetoothd[7010]: src/service.c:btd_service_connect() a2dp-source profile connect failed for XX:XX:XX:XX:XX:XX: Protocol not available
bluetoothd[7010]: [:1.50:error] < org.bluez.Error.Failed [#31]
```

`pair`,`trust`ã¾ã§ã¯ã„ã„ã®ã ãŒ`connect`ãŒå¤±æ•—ã™ã‚‹ã€ã¨ã„ã†çŠ¶æ…‹ã«ãªã‚Šã¾ã—ãŸã€‚å†ã³ChatGPTã•ã‚“æ›°ãâ€¦â€¦



ã“ã®ç—‡çŠ¶ã€éå¸¸ã«ã‚ˆãã‚ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã€**ç‰¹ã« Android ãƒ‡ãƒã‚¤ã‚¹ã¨ BlueZ ã‚’çµ„ã¿åˆã‚ã›ãŸã¨ã**ã«é »å‡ºã—ã¾ã™ã€‚è¦ç‚¹ã‚’ã¾ã¨ã‚ã¤ã¤ã€ãªãœ `connect` ã«å¤±æ•—ã—ã¦ã‚‚ `bluetooth-sendto` ã§é€ä¿¡ã§ãã‚‹ã®ã‹ã‚’è§£èª¬ã—ã¾ã™ã€‚

---

## ğŸ§  çµè«–ã‹ã‚‰ï¼š**connect ã®å¤±æ•—ã¯é‡å¤§ã§ã¯ãªã„**

`bluetoothctl` ã® `connect <address>` ã§å¤±æ•—ã™ã‚‹ã®ã¯ã€ç‰¹å®šã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãŸã¨ãˆã° A2DPï¼‰ã¸ã®æ¥ç¶šãŒå¤±æ•—ã—ã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚
**ã—ã‹ã—ã€OBEXï¼ˆãƒ•ã‚¡ã‚¤ãƒ«è»¢é€ï¼‰ã¯ `connect` ã‚’å®Ÿè¡Œã—ãªãã¦ã‚‚ Android å´ã‹ã‚‰è‡ªå‹•ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å¼µã‚Œã‚‹ãŸã‚ã€`bluetooth-sendto` ã¯æˆåŠŸã—ã¾ã™ã€‚**

---

## ğŸ” è©³ç´°ãªãƒ­ã‚°è§£æ

ã‚ãªãŸã®ãƒ­ã‚°ã®ãƒã‚¤ãƒ³ãƒˆã¯ã“ã‚Œã§ã™ï¼š

```
a2dp-source profile connect failed for 00:ED:B8:FF:0F:D0: Protocol not available
```

### â¤ ã“ã‚Œã¯ä½•ã‚’æ„å‘³ã™ã‚‹ã‹ï¼Ÿ

* `a2dp-source` = BlueZ å´ãŒ **ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚’é€ã‚Šå‡ºã™å´ï¼ˆã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ãªã©ï¼‰** ã¨ã—ã¦æŒ¯ã‚‹èˆãŠã†ã¨ã—ã¦ã„ã‚‹
* ã—ã‹ã— Android å´ã¯ **ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã§ã¯ãªã„**ï¼ˆã‚€ã—ã‚ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚½ãƒ¼ã‚¹ï¼‰
* ã‚ˆã£ã¦ã€ŒProtocol not availableã€ï¼**ãã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã¯ Android å´ãŒã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãªã„**ãŸã‚ã€æ¥ç¶šãŒæ‹’å¦ã•ã‚Œã¦ã„ã‚‹

### â¤ ã¤ã¾ã‚Šï¼š

* `bluetoothctl` ã® `connect` ã¯ã€**åˆ©ç”¨å¯èƒ½ãªå…¨ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç‰‡ã£ç«¯ã‹ã‚‰è©¦ã™**
* ãã®ä¸­ã« **Android å´ãŒéå¯¾å¿œãªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä¾‹: a2dp-sourceï¼‰** ãŒã‚ã‚‹ã¨ã€ãã‚ŒãŒå¤±æ•—ã—ã¦å…¨ä½“ãŒã€Œconnect failedã€ã«è¦‹ãˆã‚‹
* ã§ã‚‚å®Ÿéš›ã¯ã€Œä¸€éƒ¨ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½¿ãˆãªã‹ã£ãŸã ã‘ã€

---

## ğŸ“¤ ãªãœ `bluetooth-sendto` ã§ã¯é€ä¿¡ã§ããŸã®ã‹ï¼Ÿ

* `bluetooth-sendto` ã¯ **OBEX (Object Push Profile)** ã‚’ä½¿ç”¨
* ã“ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã¯ Android å´ãŒã‚µãƒãƒ¼ãƒˆã—ã¦ãŠã‚Šã€å¿…è¦ãªã¨ãã« Android å´ãŒè‡ªå‹•ã§ OBEX ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å¼µã‚Šã«æ¥ã‚‹
* ã‚ˆã£ã¦ `bluetoothctl` ã® `connect` ã‚’æˆåŠŸã•ã›ã‚‹å¿…è¦ãŒãªã„

ã¤ã¾ã‚Šï¼š

> **`connect` ã«å¤±æ•—ã—ã¦ã‚‚ã€å¿…è¦ãªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆOBEXï¼‰ãŒç›¸æ‰‹å´ã§æœ‰åŠ¹ãªã‚‰ã€ãã®ã¨ãã ã‘ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒç¢ºç«‹ã•ã‚Œã¦ä½¿ãˆã‚‹**ã€‚

---

## âœ… å¯¾å¿œã‚„è£œè¶³

### âœ” æ”¾ç½®ã§å•é¡Œãªã„ã‚±ãƒ¼ã‚¹

* ãƒ•ã‚¡ã‚¤ãƒ«é€ä¿¡ã ã‘ãŒç›®çš„ãªã‚‰ã€`connect` ã«ã“ã ã‚ã‚‰ãªãã¦OKã€‚
* Android ãƒ‡ãƒã‚¤ã‚¹å´ã‹ã‚‰ã€Œå—ä¿¡ã€å¾…æ©ŸçŠ¶æ…‹ã«ã—ã¦ãŠã‘ã°ã€å—ä¿¡ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚‚è¡¨ç¤ºã•ã‚Œã‚‹ã€‚

### âœ” æ°—ã«ãªã‚‹ãªã‚‰ `connect` å¯¾è±¡ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ¶é™

`bluetoothctl` ã§ `connect` ãŒå¤±æ•—ã—ã¦æ°—ã«ãªã‚‹å ´åˆã¯ã€BlueZ å´ã®è¨­å®šã‚’èª¿æ•´ã—ã¦ `a2dp-source` ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ï¼ˆudev ãƒ«ãƒ¼ãƒ«ã‚„ BlueZ ã‚½ãƒ¼ã‚¹ãƒ¬ãƒ™ãƒ«ã§ï¼‰ã€‚ãŸã ã—å°‘ã—é¢å€’ã€‚

### âœ” Android å´ãŒ OBEX Push å¯¾å¿œã‹ç¢ºèª

ä¸€éƒ¨ã® Android ç«¯æœ«ï¼ˆç‰¹ã«æœ€è¿‘ã® Pixel ã‚„ã‚«ã‚¹ã‚¿ãƒ  ROMï¼‰ã§ã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç†ç”±ã§ Bluetooth ãƒ•ã‚¡ã‚¤ãƒ«å—ä¿¡ï¼ˆOBEX Pushï¼‰æ©Ÿèƒ½ãŒåˆ¶é™ã•ã‚Œã¦ã„ã‚‹å ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚`bluetooth-sendto` ã§é€ã‚Œã¦ã„ã‚‹ãªã‚‰ã€å°‘ãªãã¨ã‚‚ä»Šå›ã¯ãã‚ŒãŒæœ‰åŠ¹ã ã£ãŸã¨ã„ã†ã“ã¨ã§ã™ã€‚

---

## ğŸŸ¢ ã¾ã¨ã‚

| è¦³ç‚¹                | å†…å®¹                                                |
| ----------------- | ------------------------------------------------- |
| `connect` ãŒå¤±æ•—ã™ã‚‹ç†ç”± | BlueZ ãŒä½¿ãŠã†ã¨ã—ãŸãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆä¾‹: a2dp-sourceï¼‰ãŒ Android ã«éå¯¾å¿œ |
| ãƒ•ã‚¡ã‚¤ãƒ«é€ä¿¡ãŒã§ããŸç†ç”±      | OBEX ã¯ Android å´ãŒå¯¾å¿œã—ã¦ãŠã‚Šã€è‡ªå‹•ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºç«‹ã•ã‚Œã‚‹              |
| å¯¾å‡¦ã¯å¿…è¦ã‹            | ãƒ•ã‚¡ã‚¤ãƒ«é€ä¿¡ãŒç›®çš„ãªã‚‰ç‰¹ã«å¿…è¦ãªã—                                 |

---

ã‚‚ã—ä»Šå¾Œã€ãŸã¨ãˆã° Bluetooth ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã‚„ HIDï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ï¼‰ãªã©ã¨æ¥ç¶šã™ã‚‹éš›ã« `connect` ãŒå¤±æ•—ã™ã‚‹å ´åˆã¯ã€ã¾ãŸçŠ¶æ³ã‚’æ•™ãˆã¦ã‚‚ã‚‰ãˆã‚Œã°è¨ºæ–­ã§ãã¾ã™ã€‚ãã‚Œãã‚Œé•ã†è¦å› ãŒçµ¡ã‚€ã®ã§ã€‚

Bluetooth é€šä¿¡ã«ãŠã„ã¦ã€ã€Œãƒšã‚¢ãƒªãƒ³ã‚°ã€ã“ããŒæœ€ã‚‚é‡è¦ãªã‚¹ãƒ†ãƒƒãƒ—ã§ã‚ã‚Šã€connect ã¯ã‚ãã¾ã§ ä½¿ç”¨ã—ãŸã„ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã«å¿œã˜ã¦å¿…è¦ã«ãªã£ãŸã¨ãã«è¡Œã‚ã‚Œã‚‹å‹•çš„ãªå‡¦ç†ã«ã™ãã¾ã›ã‚“ã€‚

ğŸ”‘ ãƒšã‚¢ãƒªãƒ³ã‚°ï¼ˆpair, trustï¼‰ã®å½¹å‰²
æ“ä½œ	ç›®çš„
pair	ãƒ‡ãƒã‚¤ã‚¹åŒå£«ãŒäº’ã„ã«èªè¨¼ã•ã‚Œã€å®‰å…¨ã«é€šä¿¡ã§ãã‚‹çŠ¶æ…‹ã‚’ç¢ºç«‹
trust	è‡ªå‹•æ¥ç¶šã‚„ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã€‚ãƒ¦ãƒ¼ã‚¶æ“ä½œãªã—ã«ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹

ã¤ã¾ã‚Šã€Œã“ã®ç«¯æœ«ã¨ã¯å®‰å…¨ã«é€šä¿¡ã—ã¦ã„ã„ã‚ˆã€ã¨ãŠäº’ã„ãŒç¢ºèªã—åˆã†ã‚¹ãƒ†ãƒƒãƒ—ã€‚

ã“ã‚ŒãŒæˆåŠŸã—ã¦ã„ã‚Œã°ã€å¿…è¦ãªã¨ãã«å¿…è¦ãªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ãŒæ¥ç¶šã•ã‚Œã‚‹ã¨ã„ã†æµã‚Œã«ãªã‚Šã¾ã™ã€‚

###

```bash
pacman -S gnome-bluetooth-3.0
bluetooth-sendto --device=XX:XX:... file.png	# it works
```

### GPU acceleration on chromium
Core-i5ã®ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã„ãŸã¨ã—ã¦ã‚‚ï¼ˆãã—ã¦è©¦ã—ã¦ã¯ã„ã¾ã›ã‚“ãŒã¾ãšé–“é•ã„ãªãCore-i3ã§ã‚‚ï¼‰ã€youtubeã®1080på…¨ç”»é¢å†ç”Ÿç¨‹åº¦ã§ã¯å…¨ç„¶æ™®é€šã«ä½™è£•ãŒã‚ã‚Šã¾ã™ã€‚ã¨ã¯è¨€ãˆã€å†…è”µGPUã‚’ä½¿ã£ã¦æ›´ã«CPUã«ä½™è£•ã‚’æŒãŸã›ã‚‰ã‚Œã‚Œã°ãã‚Œã¯ãã‚Œã§å¬‰ã—ã„ã‚‚ã®ã§ã™ã€‚ç™ºç†±æŠ‘åˆ¶ã«ã‚‚ãªã‚Šã¾ã™ã€‚\
[Hardware video acceleration - ArchWiki](https://wiki.archlinux.org/title/Hardware_video_acceleration)
> Intel graphics open-source drivers support VA-API:\
> HD Graphics series starting from Broadwell (2014) and newer (e.g. Intel Arc) are supported by intel-media-driver.
```
pacman -S intel-media-driver
echo "--enable-features=AcceleratedVideoDecodeLinuxGL" >> .config/chromium-flags.conf
```
ã“ã‚Œã§chromiumãŒç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å‹•ç”»å†ç”Ÿã«GPUã‚’ä½¿ã†ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ãŸã ã—youtubeã®å‹•ç”»ã§æœ‰åŠ¹ã«ã™ã‚‹ãŸã‚ã«ã¯ã‚‚ã†ä¸€ã¤å¿…è¦ãªã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚ã€Œç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã€ã¨æ›¸ã„ãŸã¨ã“ã‚ãŒãƒã‚¤ãƒ³ãƒˆã§ã€ç¾åœ¨youtubeãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§é¸æŠã—ã¦é€ä¿¡ã—ã¦ãã‚‹ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã¯ã“ã‚Œã«ã¯å½“ã¦ã¯ã¾ã‚Šã¾ã›ã‚“ã€‚ãã®ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚’ã‚’å¸¸ã«`H.264`ã«æŒ‡å®šã™ã‚‹ãŸã‚ã«[h264ify](https://chromewebstore.google.com/detail/h264ify/aleakchihdccplidncghkekgioiakgal)ã¨ã„ã†æ‹¡å¼µæ©Ÿèƒ½ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚æ­£ã—ãå‹•ä½œã—ã¦ã„ã‚‹ã‹ã®ç¢ºèªã¯`chrome://media-internals`ã‚„`/sys/class/drm/card1/gt_cur_freq_mhz`ãªã©ã‚’è¦‹ã‚‹ã‹ã€ã‚ã‚‹ã„ã¯`htop`ã‚’ä½¿ã£ã¦CPUã¨GPUã¨ã‚’åŒæ™‚ã«è¦‹æ¯”ã¹ã¦ã‚‚ã„ã„ã§ã—ã‚‡ã†ã€‚ã€‚

### Android file transfer
```
pacman -S gvfs-mtp
android file transfer
lsusb to check Bus xxx Device yyy
gio mount mtp://[usb:xxx,yyy]/
access via /run/user/$UID/gvfs/...
```
### Console font
```
echo FONT=LatGrkCyr-12x22 >> /etc/vconsole.conf
echo KEYMAP=jp106 >> /etc/vconsole.conf
```
